var numberOfTiles,playerMode,botProb,turnCount=0,pairCount=0,tryCount=0,currentPlayer=1,score1=0,score2=0,tilesSeenArray=[],tilesPairArray=[],tilesRemaining=[],botNextTile=-1,totalTurnCountForBotsGo=0,numberOfPairs,currentTileId,previousTileId,currentTilePosition,previousTilePosition,currentImg,turnBackTimeout,turnBackNeeded,clearMatchTimeout,clearMatchNeeded,player1LastTile,player1SecondLastTile,imageArray=["images/nature/pic1.jpg","images/nature/pic2.jpg","images/nature/pic3.jpg","images/nature/pic4.jpg","images/nature/pic5.jpg","images/nature/pic6.jpg","images/nature/pic7.jpg","images/nature/pic8.jpg","images/nature/pic9.jpg","images/nature/pic10.jpg","images/nature/pic11.jpg","images/nature/pic12.jpg","images/nature/pic13.jpg","images/nature/pic14.jpg","images/nature/pic15.jpg","images/nature/pic16.jpg","images/nature/pic17.jpg","images/nature/pic18.jpg","images/nature/pic19.jpg","images/nature/pic20.jpg","images/nature/pic21.jpg","images/nature/pic22.jpg","images/nature/pic23.jpg","images/nature/pic24.jpg","images/nature/pic25.jpg","images/nature/pic26.jpg","images/nature/pic27.jpg","images/nature/pic28.jpg","images/nature/pic29.jpg","images/nature/pic30.jpg"];function turnTile(tileClicked){if(clearTimeouts(),currentTileId=$(tileClicked).attr("id"),currentTilePosition=parseInt(currentTileId.substr(7)),-1!=tilesRemaining.indexOf(currentTilePosition)){$("img",tileClicked).toggle();var index=tilesRemaining.indexOf(currentTilePosition);if(tilesRemaining.splice(index,1),"bot"==playerMode){if(2==currentPlayer&&totalTurnCountForBotsGo++,currentImg=$("#"+currentTileId).find(".pic").attr("src"),-1==tilesPairArray[currentTilePosition]){var matchPosition=tilesSeenArray.indexOf(currentImg);-1!=matchPosition&&matchPosition!=currentTilePosition&&(tilesPairArray[currentTilePosition]=matchPosition,tilesPairArray[matchPosition]=currentTilePosition)}tilesSeenArray[currentTilePosition]=currentImg}1==++turnCount&&(previousTileId=currentTileId,previousTilePosition=currentTilePosition),2==turnCount&&(isMatch(previousTileId,currentTileId)?($(".layout").toggleClass("matchColor"),clearMatchNeeded=!0,clearMatchTimeout=setTimeout((function(){$(".layout").toggleClass("matchColor"),clearMatchNeeded=!1}),1e3),pairCount++,"bot"==playerMode&&(1==currentPlayer?(score1++,$("#score1").html(score1)):(score2++,$("#score2").html(score2)),pairCount==numberOfPairs&&(score1>score2?($("#go").html("You Win!"),$("#go").removeClass("go2"),$("#go").addClass("go1"),$("#player2").removeClass("player2Go"),$("#player1").addClass("player1Go")):score2>score1?($("#go").html("Bot Wins!"),$("#go").removeClass("go1"),$("#go").addClass("go2"),$("#player1").removeClass("player1Go"),$("#player2").addClass("player2Go")):($("#go").html("It's a Tie!"),$("#go").removeClass("go1"),$("#go").removeClass("go2"),$("#go").addClass("tie"),$("#player1").addClass("player1Go"),$("#player2").addClass("player2Go"))))):(tilesRemaining.push(previousTilePosition),tilesRemaining.push(currentTilePosition),turnBackNeeded=!0,turnBackTimeout=setTimeout((function(){$("img","#"+previousTileId).toggle(),$("img","#"+currentTileId).toggle(),turnBackNeeded=!1}),1e3),"bot"==playerMode&&(1==currentPlayer?(currentPlayer=2,$("#go").html("Bot's Turn"),player1SecondLastTile=previousTilePosition,player1LastTile=currentTilePosition,botNextTile=-1):(currentPlayer=1,$("#go").html("Your Turn"),totalTurnCountForBotsGo=0),toggleGoClasses())),turnCount=0,"one"==playerMode&&(tryCount++,pairCount==numberOfPairs?($("#tries").toggleClass("triesColor"),$("#tries").toggleClass("triesColorDone"),$("#tries").html("Done in "+tryCount+" tries!")):$("#tryCount").html(tryCount)))}var tileToTurn;"bot"==playerMode&&2==currentPlayer&&pairCount<numberOfPairs&&(-1!=botNextTile?(tileToTurn=Math.random()<=botProb?botNextTile:1==totalTurnCountForBotsGo?getRandTileNotLastPlayers():getRandomAvailableTile(),botNextTile=-1):0==totalTurnCountForBotsGo?-1==(tileToTurn=botStrategy1())&&-1==(tileToTurn=botStrategy2())&&-1==(tileToTurn=botStrategy3())&&(tileToTurn=getRandTileNotLastPlayers()):1==totalTurnCountForBotsGo?-1==(tileToTurn=getPair(currentTilePosition))&&(tileToTurn=getRandTileNotLastPlayers()):0==turnCount?-1==(tileToTurn=botStrategy3())&&(tileToTurn=getRandomAvailableTile()):1==turnCount&&-1!=(tileToTurn=getPair(currentTilePosition))?Math.random()<botProb+.1&&(tileToTurn=getRandomAvailableTile()):tileToTurn=getRandomAvailableTile(),0==turnCount?setTimeout((function(){turnTile($("#tile"+pad(numberOfTiles,2)+"-"+tileToTurn))}),1100):setTimeout((function(){turnTile($("#tile"+pad(numberOfTiles,2)+"-"+tileToTurn))}),500))}function botStrategy1(){var tile=-1;return-1!=tilesPairArray[player1LastTile]&&-1!=tilesRemaining.indexOf(player1LastTile)&&(tile=player1LastTile,botNextTile=tilesPairArray[player1LastTile]),tile}function botStrategy2(){var tile=-1;return-1!=tilesPairArray[player1SecondLastTile]&&-1!=tilesRemaining.indexOf(player1SecondLastTile)&&(tile=player1SecondLastTile,botNextTile=tilesPairArray[player1SecondLastTile]),tile}function botStrategy3(){var tile=-1;for(i=0;i<numberOfTiles;i++)if(-1!=tilesPairArray[i]&&-1!=tilesRemaining.indexOf(i)){tile=i,botNextTile=tilesPairArray[i];break}return tile}function getPair(tile){var pair;return-1==(pair=tilesPairArray[tile])?-1:pair}function getRandomAvailableTile(){var indexRand;return indexRand=Math.floor(Math.random()*tilesRemaining.length),tilesRemaining[indexRand]}function getRandTileNotLastPlayers(){var indexRand,tileRand;do{indexRand=Math.floor(Math.random()*tilesRemaining.length),tileRand=tilesRemaining[indexRand]}while(tileRand==player1LastTile||tileRand==player1SecondLastTile);return tileRand}function clearTimeouts(){clearTimeout(clearMatchTimeout),clearMatchNeeded&&($(".layout").toggleClass("matchColor"),clearMatchNeeded=!1),clearTimeout(turnBackTimeout),turnBackNeeded&&($("img","#"+previousTileId).toggle(),$("img","#"+currentTileId).toggle(),turnBackNeeded=!1)}function isMatch(tile1,tile2){return $("#"+tile1).find(".pic").attr("src")==$("#"+tile2).find(".pic").attr("src")}function toggleGoClasses(){$("#go").toggleClass("go1"),$("#go").toggleClass("go2"),$("#player1").toggleClass("player1Go"),$("#player2").toggleClass("player2Go")}function shuffle(array){for(var currentIndex=array.length,randomIndex,temp;currentIndex;)currentIndex--,randomIndex=Math.floor(Math.random()*currentIndex),temp=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temp}function pad(number,length){for(var str=""+number;str.length<length;)str="0"+str;return str}function reset(){for(turnCount=0,pairCount=0,tryCount=0,currentPlayer=1,score1=0,score2=0,tilesSeenArray=[],tilesPairArray=[],tilesRemaining=[],botNextTile=-1,totalTurnCountForBotsGo=0,$("#tries").html('Tries: <span id="tryCount">0</span>'),$("#tries").removeClass("triesColorDone"),$("#tries").addClass("triesColor"),$("#go").html("Your Turn"),$("#go").removeClass("tie"),$("#go").removeClass("go2"),$("#go").addClass("go1"),$("#player2").removeClass("player2Go"),$("#player1").addClass("player1Go"),$("#score1").html("0"),$("#score2").html("0"),clearTimeouts(),i=0;i<numberOfTiles;i++)$("#tile"+pad(numberOfTiles,2)+"-"+i).find(".back").show(),$("#tile"+pad(numberOfTiles,2)+"-"+i).find(".pic").hide()}function newLayout(){for(numberOfPairs=numberOfTiles/2,i=0;i<numberOfTiles;i++)tilesSeenArray[i]=-1,tilesPairArray[i]=-1,tilesRemaining[i]=i;shuffle(imageArray);var tileArray=imageArray.slice(0,numberOfTiles/2);for(shuffle(tileArray=tileArray.concat(tileArray)),i=0;i<numberOfTiles;i++)$("#tile"+pad(numberOfTiles,2)+"-"+i).find(".pic").attr("src",tileArray[i])}let deferredPrompt;function installApp(){deferredPrompt.prompt(),installButton.disabled=!0,deferredPrompt.userChoice.then(choiceResult=>{"accepted"===choiceResult.outcome?(console.log("PWA setup accepted"),installButton.hidden=!0):console.log("PWA setup rejected"),installButton.disabled=!1,deferredPrompt=null})}$("#btnOne").click((function(){$(this).addClass("btnModeActive"),$(this).attr("title","Current game mode is One Player"),$("#btnBot").removeClass("btnModeActive"),$("#btnBot").attr("title","Set game mode to Bot"),playerMode="one",reset(),newLayout(),$("#tries").show(),$("#scores").hide()})),$("#btnBot").click((function(){$(this).addClass("btnModeActive"),$(this).attr("title","Current game mode is Bot"),$("#btnOne").removeClass("btnModeActive"),$("#btnOne").attr("title","Set game mode to One Player"),playerMode="bot",reset(),newLayout(),$("#tries").hide(),$("#scores").show()})),$("#btnNewGame").click((function(){reset(),newLayout()})),$("#btnOptions").click((function(){8==numberOfTiles?$("#eight").prop("checked",!0):16==numberOfTiles?$("#sixteen").prop("checked",!0):36==numberOfTiles&&$("#thirtysix").prop("checked",!0),$("#optionsModal").modal("toggle")})),$("#btnDone").click((function(){$("#eight").prop("checked")?(numberOfTiles=8,botProb=.5,$("#layout08").show(),$("#layout16").hide(),$("#layout36").hide()):$("#sixteen").prop("checked")?(numberOfTiles=16,botProb=.5,$("#layout08").hide(),$("#layout16").show(),$("#layout36").hide()):$("#thirtysix").prop("checked")&&(numberOfTiles=36,botProb=.4,$("#layout08").hide(),$("#layout16").hide(),$("#layout36").show()),reset(),newLayout(),$("#optionsModal").modal("toggle")})),$(".tile").click((function(){("bot"!=playerMode||"bot"==playerMode&&1==currentPlayer)&&turnTile(this)})),$(document).ready((function(){numberOfTiles=16,playerMode="one",botProb=.5,newLayout(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/turntiles/sw.js").then(serviceWorker=>{console.log("Service Worker registered: ",serviceWorker)}).catch(error=>{console.error("Error registering the Service Worker: ",error)})})),window.addEventListener("beforeinstallprompt",e=>{console.log("beforeinstallprompt fired"),e.preventDefault(),deferredPrompt=e;const installButton=document.getElementById("btnInstall");installButton.hidden=!1,installButton.addEventListener("click",installApp)});